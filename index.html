<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REACT OR DRINK</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a0f;
            overflow: hidden;
            font-family: 'Press Start 2P', monospace;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        /* Game Show Stage Background */
        .stage-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(180deg,
                #0a0015 0%,
                #1a0a2e 30%,
                #2d1b4e 60%,
                #1a0a2e 100%
            );
        }

        .stage-floor {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 25%;
            background: linear-gradient(180deg, #1a1a2e 0%, #0a0a15 100%);
            border-top: 4px solid #ff00ff;
            box-shadow: 0 -20px 60px rgba(255, 0, 255, 0.3);
        }

        .spotlight {
            position: absolute;
            width: 300px;
            height: 400px;
            pointer-events: none;
        }
        .spotlight-left {
            top: 0; left: 5%;
            background: radial-gradient(ellipse at top, rgba(255, 0, 255, 0.15) 0%, transparent 70%);
        }
        .spotlight-right {
            top: 0; right: 5%;
            background: radial-gradient(ellipse at top, rgba(0, 255, 255, 0.15) 0%, transparent 70%);
        }
        .spotlight-center {
            top: 0; left: 50%; transform: translateX(-50%);
            width: 500px;
            background: radial-gradient(ellipse at top, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }

        .neon-header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            display: none; /* hidden initially, shown when leaving title screen */
        }
        .neon-title {
            font-size: 42px;
            color: #ff00ff;
            text-shadow:
                0 0 10px #ff00ff,
                0 0 20px #ff00ff,
                0 0 40px #ff00ff,
                3px 3px 0 #00ffff;
            letter-spacing: 4px;
        }
        .neon-sub {
            font-size: 14px;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
            margin-top: 5px;
            letter-spacing: 6px;
        }

        /* Webcam preview */
        #webcam-area {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 50;
        }
        #webcam-preview {
            width: 280px;
            height: 210px;
            border: 4px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
            overflow: hidden;
            background: #000;
        }
        #webcam-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        #video-container { position: absolute; opacity: 0; pointer-events: none; }

        .current-player-label {
            font-size: 11px;
            color: #000;
            text-align: center;
            margin-top: 10px;
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            padding: 8px 15px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* ============ SCREENS ============ */
        .screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .screen.active { display: flex; }

        /* ============ TITLE SCREEN ============ */
        #title-screen {
            overflow-y: auto;
            padding: 40px 20px;
            background: linear-gradient(180deg, #0a0015 0%, #1a0a2e 50%, #0a0015 100%);
            justify-content: flex-start;
            align-items: center;
        }

        .title-content {
            max-width: 1000px;
            text-align: center;
            width: 100%;
        }

        .big-title {
            font-size: 56px;
            color: #ff00ff;
            text-shadow:
                0 0 20px #ff00ff,
                0 0 40px #ff00ff,
                0 0 80px #ff00ff,
                4px 4px 0 #00ffff;
            margin-bottom: 10px;
            letter-spacing: 4px;
        }
        .big-subtitle {
            font-size: 14px;
            color: #00ffff;
            text-shadow: 0 0 15px #00ffff;
            margin-bottom: 40px;
            letter-spacing: 6px;
        }

        /* Two Column Layout */
        .title-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
            text-align: left;
        }

        .title-section {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid;
            padding: 25px 30px;
        }
        .title-section.rules-section { border-color: #ff00ff; box-shadow: 0 0 30px rgba(255,0,255,0.2); }
        .title-section.drinks-section { border-color: #ffcc00; box-shadow: 0 0 30px rgba(255,204,0,0.2); }

        .section-header {
            font-size: 14px;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }
        .rules-section .section-header { color: #ff00ff; }
        .drinks-section .section-header { color: #ffcc00; }

        .rule-item {
            font-size: 10px;
            color: #ccc;
            margin-bottom: 15px;
            line-height: 1.8;
            padding-left: 25px;
            position: relative;
        }
        .rule-item::before {
            content: attr(data-num);
            position: absolute;
            left: 0;
            color: #ff00ff;
            font-size: 12px;
        }
        .rule-item .hl { color: #ffcc00; }
        .rule-item .bad { color: #ff6666; }
        .rule-item .good { color: #66ff66; }
        .rule-item .sass { color: #888; font-size: 9px; }

        /* Drink Table */
        .drink-table {
            width: 100%;
        }
        .drink-row {
            display: grid;
            grid-template-columns: 60px 100px 1fr;
            gap: 15px;
            font-size: 10px;
            padding: 12px 0;
            border-bottom: 1px solid #333;
            align-items: center;
        }
        .drink-row:last-child { border-bottom: none; }
        .drink-row .score { color: #00ffff; font-size: 12px; }
        .drink-row .verdict { color: #ff00ff; }
        .drink-row .penalty { color: #ccc; font-size: 9px; }

        /* Twists Section */
        .twists-section {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #00ffff;
            box-shadow: 0 0 30px rgba(0,255,255,0.2);
            padding: 25px 30px;
            margin-bottom: 40px;
        }
        .twists-section .section-header { color: #00ffff; text-align: center; margin-bottom: 25px; }

        .twist-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
        }
        .twist-item {
            text-align: center;
        }
        .twist-name {
            font-size: 10px;
            color: #ff00ff;
            margin-bottom: 8px;
        }
        .twist-desc {
            font-size: 8px;
            color: #888;
            line-height: 1.6;
        }

        /* Pose Guide */
        .pose-section {
            margin-bottom: 40px;
        }
        .pose-section-title {
            font-size: 14px;
            color: #ff00ff;
            margin-bottom: 25px;
            letter-spacing: 3px;
            text-align: center;
        }
        .pose-guide {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        .pose-card {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #333;
            padding: 15px;
            width: 110px;
            text-align: center;
            transition: all 0.2s;
        }
        .pose-card:hover {
            border-color: #00ffff;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,255,255,0.3);
        }
        .pose-icon {
            width: 60px;
            height: 65px;
            margin: 0 auto 10px;
        }
        .pose-icon svg {
            width: 100%;
            height: 100%;
        }
        .pose-card .pose-name {
            font-size: 7px;
            color: #00ffff;
            line-height: 1.4;
        }

        #start-game-btn-title {
            padding: 25px 80px;
            font-family: 'Press Start 2P', monospace;
            font-size: 18px;
            background: linear-gradient(180deg, #ff00ff, #aa00aa);
            color: #fff;
            border: none;
            cursor: pointer;
            box-shadow: 0 0 50px rgba(255, 0, 255, 0.6);
            transition: all 0.2s;
        }
        #start-game-btn-title:hover {
            transform: scale(1.05);
            box-shadow: 0 0 80px rgba(255, 0, 255, 0.8);
        }

        /* ============ SETUP SCREEN ============ */
        #setup-screen .setup-box {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #ff00ff;
            padding: 30px 50px;
            text-align: center;
            box-shadow: 0 0 40px rgba(255, 0, 255, 0.3);
            max-width: 500px;
        }

        .setup-title {
            font-size: 18px;
            color: #ff00ff;
            margin-bottom: 20px;
        }

        .player-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        #player-name-input {
            flex: 1;
            padding: 12px 15px;
            font-family: 'Press Start 2P', monospace;
            font-size: 12px;
            background: #1a1a2e;
            border: 2px solid #444;
            color: #fff;
            outline: none;
        }
        #player-name-input:focus {
            border-color: #00ffff;
        }
        #add-player-btn {
            padding: 12px 20px;
            font-family: 'Press Start 2P', monospace;
            font-size: 12px;
            background: #00ffff;
            color: #000;
            border: none;
            cursor: pointer;
        }
        #add-player-btn:hover { background: #00dddd; }

        .player-list {
            min-height: 80px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        .player-tag {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #2d1b4e, #1a0a2e);
            border: 2px solid #ff00ff;
            color: #fff;
            font-size: 10px;
            padding: 10px 15px;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.3);
        }
        .player-tag .remove-btn {
            margin-left: 12px;
            color: #ff6666;
            cursor: pointer;
            font-size: 12px;
        }
        .player-tag .remove-btn:hover { color: #ff0000; }

        .player-count-info {
            font-size: 9px;
            color: #888;
            margin-bottom: 15px;
        }

        #start-game-btn {
            padding: 18px 40px;
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            background: linear-gradient(180deg, #ff00ff, #aa00aa);
            color: #fff;
            border: none;
            cursor: pointer;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
            margin-top: 10px;
        }
        #start-game-btn:hover { transform: scale(1.05); }
        #start-game-btn:disabled {
            background: #444;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* ============ WHEEL SCREEN ============ */
        #wheel-screen {
            background: rgba(0, 0, 0, 0.95);
        }

        .wheel-title {
            font-size: 28px;
            color: #ffcc00;
            text-shadow: 0 0 30px #ffcc00, 0 0 60px #ff6600;
            margin-bottom: 40px;
            letter-spacing: 4px;
        }

        .wheel-wrapper {
            position: relative;
            width: 350px;
            height: 350px;
        }

        .wheel-container {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #ff00ff;
            box-shadow: 0 0 40px rgba(255, 0, 255, 0.4), inset 0 0 30px rgba(0,0,0,0.5);
            overflow: hidden;
            position: relative;
        }

        .wheel-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        .wheel-canvas {
            width: 100%;
            height: 100%;
        }

        .wheel-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 35px solid #ffcc00;
            filter: drop-shadow(0 0 10px #ffcc00);
        }

        .wheel-center-hub {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #2d1b4e 0%, #0a0015 100%);
            border: 4px solid #ffcc00;
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .wheel-center-hub::after {
            content: '?';
            font-size: 20px;
            color: #ffcc00;
            text-shadow: 0 0 10px #ffcc00;
        }

        .wheel-result {
            font-size: 20px;
            color: #00ffff;
            text-shadow: 0 0 20px #00ffff;
            margin-top: 40px;
            min-height: 35px;
        }

        /* ============ GAME SCREEN ============ */
        #game-screen {
            z-index: 90;
        }

        .round-info {
            position: absolute;
            top: 120px;
            left: 30px;
            z-index: 10;
        }
        .round-label { font-size: 10px; color: #888; }
        .round-num { font-size: 24px; color: #00ffff; text-shadow: 0 0 15px #00ffff; }

        .twist-badge {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 255, 0.3);
            border: 2px solid #ff00ff;
            padding: 8px 20px;
            font-size: 11px;
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .twist-badge.show { opacity: 1; }

        .score-display {
            position: absolute;
            top: 120px;
            right: 320px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffcc00;
            padding: 10px 20px;
            z-index: 10;
        }
        .score-label { font-size: 9px; color: #888; }
        .score-val { font-size: 20px; color: #ffcc00; text-shadow: 0 0 10px #ffcc00; }

        /* Pose prompt area */
        .prompt-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 20;
        }

        .countdown-text {
            font-size: 150px;
            color: #ffcc00;
            text-shadow: 0 0 50px #ffcc00, 0 0 100px #ff6600;
            opacity: 0;
        }
        .countdown-text.show {
            opacity: 1;
            animation: countPop 0.5s ease-out;
        }
        @keyframes countPop {
            0% { transform: scale(2.5); opacity: 0; }
            30% { transform: scale(0.9); opacity: 1; }
            100% { transform: scale(1); }
        }

        .pose-prompt {
            opacity: 0;
            transition: opacity 0.15s;
        }
        .pose-prompt.show { opacity: 1; }

        .pose-silhouette {
            width: 120px;
            height: 140px;
            margin: 0 auto 15px;
        }
        .pose-silhouette svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px #00ffff);
        }

        .pose-text {
            font-size: 42px;
            color: #00ffff;
            text-shadow: 0 0 30px #00ffff, 0 0 60px #00ffff, 3px 3px 0 #000;
            margin-bottom: 10px;
        }
        .pose-hint {
            font-size: 12px;
            color: #888;
        }

        .pose-prompt.bait .pose-text {
            color: #ff0000;
            text-shadow: 0 0 30px #ff0000, 0 0 60px #ff0000, 3px 3px 0 #000;
            animation: baitShake 0.1s infinite;
        }
        .pose-prompt.bait .pose-silhouette svg {
            filter: drop-shadow(0 0 20px #ff0000);
        }
        @keyframes baitShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        /* Timer bar */
        .timer-container {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 450px;
            z-index: 10;
        }
        .timer-bar-bg {
            height: 14px;
            background: #222;
            border: 2px solid #444;
        }
        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ffcc00, #00ff00);
            width: 100%;
            transform-origin: left;
            transition: transform 0.05s linear;
        }
        .timer-label {
            font-size: 8px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }

        .match-status {
            position: absolute;
            bottom: 110px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #888;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .match-status.show { opacity: 1; }
        .match-status.holding { color: #ffcc00; }
        .match-status.matched { color: #00ff00; text-shadow: 0 0 15px #00ff00; }

        /* Result overlay */
        .result-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 30;
            opacity: 0;
            pointer-events: none;
        }
        .result-overlay.show {
            opacity: 1;
            animation: resultPop 1.5s ease-out forwards;
        }
        @keyframes resultPop {
            0% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
            15% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -60%) scale(0.9); }
        }
        .result-text {
            font-size: 52px;
            margin-bottom: 10px;
        }
        .result-text.success { color: #00ff00; text-shadow: 0 0 30px #00ff00; }
        .result-text.fail { color: #ff0000; text-shadow: 0 0 30px #ff0000; }
        .result-sub {
            font-size: 12px;
            color: #ffcc00;
        }

        /* Commentary */
        .commentary {
            position: absolute;
            bottom: 160px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
            z-index: 25;
            opacity: 0;
            text-align: center;
            max-width: 500px;
        }
        .commentary.show {
            opacity: 1;
            animation: commentFade 2s ease-out forwards;
        }
        @keyframes commentFade {
            0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* ============ RESULTS SCREEN ============ */
        #results-screen {
            background: rgba(0, 0, 0, 0.95);
        }
        .results-box {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #00ffff;
            padding: 30px 50px;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.3);
        }
        .results-player {
            font-size: 24px;
            color: #ffcc00;
            text-shadow: 0 0 20px #ffcc00;
            margin-bottom: 10px;
        }
        .results-score {
            font-size: 48px;
            color: #00ffff;
            text-shadow: 0 0 30px #00ffff;
            margin-bottom: 15px;
        }
        .results-verdict {
            font-size: 14px;
            color: #ff00ff;
            margin-bottom: 10px;
        }
        .results-drinks {
            font-size: 18px;
            color: #ffcc00;
            text-shadow: 0 0 15px #ffcc00;
            margin-bottom: 20px;
        }
        .results-commentary {
            font-size: 10px;
            color: #888;
            max-width: 400px;
            line-height: 1.8;
            margin-bottom: 25px;
        }

        .nominate-section {
            margin-top: 20px;
        }
        .nominate-title {
            font-size: 12px;
            color: #ff00ff;
            margin-bottom: 15px;
        }
        .nominate-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .nominate-btn {
            padding: 12px 20px;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            background: #2d1b4e;
            border: 2px solid #ff00ff;
            color: #fff;
            cursor: pointer;
        }
        .nominate-btn:hover {
            background: #ff00ff;
            color: #000;
        }

        /* ============ END SCREEN ============ */
        #end-screen {
            background: rgba(0, 0, 0, 0.95);
        }
        .end-title {
            font-size: 36px;
            color: #ff00ff;
            text-shadow: 0 0 40px #ff00ff;
            margin-bottom: 30px;
        }
        .leaderboard {
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #00ffff;
            padding: 25px 40px;
            margin-bottom: 20px;
            min-width: 400px;
        }
        .leaderboard-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #fff;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
        .leaderboard-row:last-child { border-bottom: none; }
        .leaderboard-row .rank { color: #ffcc00; width: 30px; }
        .leaderboard-row .name { flex: 1; }
        .leaderboard-row .drinks { color: #ff6666; }

        .end-roast {
            font-size: 11px;
            color: #ff00ff;
            max-width: 450px;
            text-align: center;
            line-height: 1.8;
            margin-bottom: 25px;
        }

        #play-again-btn {
            padding: 18px 50px;
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            background: linear-gradient(180deg, #00ffff, #0088aa);
            color: #000;
            border: none;
            cursor: pointer;
        }

        /* Loading */
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            color: #00ffff;
            z-index: 500;
            background: #000;
            padding: 30px 50px;
            border: 3px solid #ff00ff;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Stage Background -->
        <div class="stage-bg">
            <div class="spotlight spotlight-left"></div>
            <div class="spotlight spotlight-right"></div>
            <div class="spotlight spotlight-center"></div>
            <div class="stage-floor"></div>
        </div>

        <!-- Neon Header -->
        <div class="neon-header">
            <div class="neon-title">REACT OR DRINK</div>
            <div class="neon-sub">THE PARTY GAME</div>
        </div>

        <!-- Webcam -->
        <div id="video-container">
            <video id="webcam" autoplay playsinline></video>
        </div>
        <div id="webcam-area" class="hidden">
            <div id="webcam-preview">
                <video id="preview-video" autoplay playsinline muted></video>
            </div>
            <div class="current-player-label" id="current-player-label">PLAYER</div>
        </div>

        <!-- ============ TITLE SCREEN ============ -->
        <div id="title-screen" class="screen active">
            <div class="title-content">
                <div class="big-title">REACT OR DRINK</div>
                <div class="big-subtitle">DO THE POSE OR FACE THE CONSEQUENCES</div>

                <div class="title-columns">
                    <div class="title-section rules-section">
                        <div class="section-header">// HOW TO EMBARRASS YOURSELF //</div>
                        <div class="rule-item" data-num="1">
                            Enter everyone's names. <span class="hl">2-8 degenerates</span> can play.
                            <br><span class="sass">the more the merrier (for us watching you fail)</span>
                        </div>
                        <div class="rule-item" data-num="2">
                            The wheel picks who goes first. You don't get a choice.
                            <br><span class="sass">fate is a cruel bitch</span>
                        </div>
                        <div class="rule-item" data-num="3">
                            You get <span class="hl">5 rounds</span> in the hot seat. A pose appears.
                            <br><span class="bad">DO IT FAST.</span> The camera is watching and judging.
                        </div>
                        <div class="rule-item" data-num="4">
                            Hold the pose for half a second. If you can't do that,
                            <br><span class="sass">maybe stick to beer pong, sweetie</span>
                        </div>
                        <div class="rule-item" data-num="5">
                            <span class="good">Nail all 5?</span> Pick who goes next AND who drinks.
                            <br><span class="bad">Fail miserably?</span> You drink. A lot. The wheel picks next.
                        </div>
                    </div>

                    <div class="title-section drinks-section">
                        <div class="section-header">// DRINKING DAMAGE CHART //</div>
                        <div class="drink-table">
                            <div class="drink-row">
                                <span class="score">5/5</span>
                                <span class="verdict">IMMUNE</span>
                                <span class="penalty">nominate someone to drink. king shit.</span>
                            </div>
                            <div class="drink-row">
                                <span class="score">4/5</span>
                                <span class="verdict">SAFE</span>
                                <span class="penalty">nothing. boring but alive.</span>
                            </div>
                            <div class="drink-row">
                                <span class="score">3/5</span>
                                <span class="verdict">SAFE</span>
                                <span class="penalty">you survived. barely.</span>
                            </div>
                            <div class="drink-row">
                                <span class="score">2/5</span>
                                <span class="verdict">ROUGH</span>
                                <span class="penalty">take 1 drink. you earned it.</span>
                            </div>
                            <div class="drink-row">
                                <span class="score">1/5</span>
                                <span class="verdict">YIKES</span>
                                <span class="penalty">take 2 drinks. your ancestors weep.</span>
                            </div>
                            <div class="drink-row">
                                <span class="score">0/5</span>
                                <span class="verdict">PATHETIC</span>
                                <span class="penalty">3 drinks + wheel of shame picks next. clown behavior.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="twists-section">
                    <div class="section-header">// ROUND 3+ GETS SPICY //</div>
                    <div class="twist-grid">
                        <div class="twist-item">
                            <div class="twist-name">BAIT & SWITCH</div>
                            <div class="twist-desc">pose changes mid-round. keep up or shut up.</div>
                        </div>
                        <div class="twist-item">
                            <div class="twist-name">COPYCAT</div>
                            <div class="twist-desc">do the last pose again. hope you were paying attention.</div>
                        </div>
                        <div class="twist-item">
                            <div class="twist-name">OPPOSITE DAY</div>
                            <div class="twist-desc">do literally any OTHER pose. brain vs body.</div>
                        </div>
                        <div class="twist-item">
                            <div class="twist-name">SPEED ROUND</div>
                            <div class="twist-desc">3 poses in 3 seconds. panic is appropriate.</div>
                        </div>
                        <div class="twist-item">
                            <div class="twist-name">FREEZE FRAME</div>
                            <div class="twist-desc">dance around, then FREEZE. one twitch and you're done.</div>
                        </div>
                    </div>
                </div>

                <div class="pose-section">
                    <div class="pose-section-title">// THE POSES (LEARN THEM OR SUFFER) //</div>
                    <div class="pose-guide" id="pose-guide"></div>
                </div>

                <button id="start-game-btn-title">I'M READY TO LOOK STUPID</button>
            </div>
        </div>

        <!-- ============ SETUP SCREEN ============ -->
        <div id="setup-screen" class="screen">
            <div class="setup-box">
                <div class="setup-title">WHO'S PLAYING?</div>
                <div class="player-input-row">
                    <input type="text" id="player-name-input" placeholder="Enter name..." maxlength="10">
                    <button id="add-player-btn">+</button>
                </div>
                <div class="player-count-info" id="player-count-info">2-8 victims required</div>
                <div class="player-list" id="player-list"></div>
                <button id="start-game-btn" disabled>SPIN THE WHEEL</button>
            </div>
        </div>

        <!-- ============ WHEEL SCREEN ============ -->
        <div id="wheel-screen" class="screen">
            <div class="wheel-title" id="wheel-title">WHO'S FIRST?</div>
            <div class="wheel-wrapper">
                <div class="wheel-container">
                    <div class="wheel-inner" id="wheel-inner">
                        <canvas id="wheel-canvas" class="wheel-canvas" width="334" height="334"></canvas>
                    </div>
                </div>
                <div class="wheel-pointer"></div>
                <div class="wheel-center-hub"></div>
            </div>
            <div class="wheel-result" id="wheel-result"></div>
        </div>

        <!-- ============ GAME SCREEN ============ -->
        <div id="game-screen" class="screen">
            <div class="round-info">
                <div class="round-label">ROUND</div>
                <div class="round-num" id="round-num">1</div>
            </div>

            <div class="twist-badge" id="twist-badge"></div>

            <div class="score-display">
                <div class="score-label">SCORE</div>
                <div class="score-val" id="score-val">0/5</div>
            </div>

            <div class="prompt-area">
                <div class="countdown-text" id="countdown"></div>
                <div class="pose-prompt" id="pose-prompt">
                    <div class="pose-silhouette" id="pose-silhouette"></div>
                    <div class="pose-text" id="pose-text">T-POSE</div>
                    <div class="pose-hint" id="pose-hint">arms out to the sides</div>
                </div>
            </div>

            <div class="result-overlay" id="result-overlay">
                <div class="result-text" id="result-text">NICE</div>
                <div class="result-sub" id="result-sub"></div>
            </div>

            <div class="commentary" id="commentary"></div>

            <div class="match-status" id="match-status">HOLD IT...</div>

            <div class="timer-container">
                <div class="timer-bar-bg">
                    <div class="timer-bar" id="timer-bar"></div>
                </div>
                <div class="timer-label">REACT!</div>
            </div>
        </div>

        <!-- ============ RESULTS SCREEN ============ -->
        <div id="results-screen" class="screen">
            <div class="results-box">
                <div class="results-player" id="results-player">PLAYER</div>
                <div class="results-score" id="results-score">3/5</div>
                <div class="results-verdict" id="results-verdict">SAFE</div>
                <div class="results-drinks" id="results-drinks"></div>
                <div class="results-commentary" id="results-commentary"></div>

                <div class="nominate-section" id="nominate-section">
                    <div class="nominate-title" id="nominate-title">CHOOSE YOUR VICTIM</div>
                    <div class="nominate-buttons" id="nominate-buttons"></div>
                </div>
            </div>
        </div>

        <!-- ============ END SCREEN ============ -->
        <div id="end-screen" class="screen">
            <div class="end-title">GAME OVER</div>
            <div class="leaderboard" id="leaderboard"></div>
            <div class="end-roast" id="end-roast"></div>
            <button id="play-again-btn">RUN IT BACK</button>
        </div>

        <div id="loading">LOADING POSE DETECTION...</div>
    </div>

    <!-- MediaPipe Pose -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>

    <script>
        // ============ POSE SILHOUETTES (SVG) ============
        const POSE_SVGS = {
            stickemup: `<svg viewBox="0 0 60 80">
                <circle cx="30" cy="12" r="10" fill="#00ffff"/>
                <line x1="30" y1="22" x2="30" y2="50" stroke="#00ffff" stroke-width="4"/>
                <line x1="30" y1="30" x2="10" y2="15" stroke="#00ffff" stroke-width="4"/>
                <line x1="30" y1="30" x2="50" y2="15" stroke="#00ffff" stroke-width="4"/>
                <line x1="30" y1="50" x2="15" y2="75" stroke="#00ffff" stroke-width="4"/>
                <line x1="30" y1="50" x2="45" y2="75" stroke="#00ffff" stroke-width="4"/>
            </svg>`,
            tpose: `<svg viewBox="0 0 80 70">
                <circle cx="40" cy="10" r="8" fill="#00ffff"/>
                <line x1="40" y1="18" x2="40" y2="45" stroke="#00ffff" stroke-width="4"/>
                <line x1="5" y1="28" x2="75" y2="28" stroke="#00ffff" stroke-width="4"/>
                <line x1="40" y1="45" x2="25" y2="68" stroke="#00ffff" stroke-width="4"/>
                <line x1="40" y1="45" x2="55" y2="68" stroke="#00ffff" stroke-width="4"/>
            </svg>`,
            flex: `<svg viewBox="0 0 70 70">
                <circle cx="35" cy="10" r="8" fill="#00ffff"/>
                <line x1="35" y1="18" x2="35" y2="45" stroke="#00ffff" stroke-width="4"/>
                <line x1="35" y1="25" x2="15" y2="30" stroke="#00ffff" stroke-width="4"/>
                <line x1="15" y1="30" x2="20" y2="12" stroke="#00ffff" stroke-width="4"/>
                <line x1="35" y1="25" x2="55" y2="30" stroke="#00ffff" stroke-width="4"/>
                <line x1="55" y1="30" x2="50" y2="12" stroke="#00ffff" stroke-width="4"/>
                <line x1="35" y1="45" x2="22" y2="68" stroke="#00ffff" stroke-width="4"/>
                <line x1="35" y1="45" x2="48" y2="68" stroke="#00ffff" stroke-width="4"/>
            </svg>`,
            dab: `<svg viewBox="0 0 80 70">
                <circle cx="35" cy="10" r="8" fill="#00ffff"/>
                <line x1="35" y1="18" x2="35" y2="45" stroke="#00ffff" stroke-width="4"/>
                <line x1="35" y1="25" x2="55" y2="10" stroke="#00ffff" stroke-width="4"/>
                <line x1="55" y1="10" x2="75" y2="5" stroke="#00ffff" stroke-width="4"/>
                <line x1="35" y1="25" x2="25" y2="18" stroke="#00ffff" stroke-width="4"/>
                <line x1="25" y1="18" x2="30" y2="8" stroke="#00ffff" stroke-width="4"/>
                <line x1="35" y1="45" x2="22" y2="68" stroke="#00ffff" stroke-width="4"/>
                <line x1="35" y1="45" x2="48" y2="68" stroke="#00ffff" stroke-width="4"/>
            </svg>`,
            shrug: `<svg viewBox="0 0 80 70">
                <circle cx="40" cy="10" r="8" fill="#00ffff"/>
                <line x1="40" y1="18" x2="40" y2="45" stroke="#00ffff" stroke-width="4"/>
                <line x1="40" y1="25" x2="20" y2="20" stroke="#00ffff" stroke-width="4"/>
                <line x1="20" y1="20" x2="10" y2="30" stroke="#00ffff" stroke-width="4"/>
                <line x1="40" y1="25" x2="60" y2="20" stroke="#00ffff" stroke-width="4"/>
                <line x1="60" y1="20" x2="70" y2="30" stroke="#00ffff" stroke-width="4"/>
                <line x1="40" y1="45" x2="27" y2="68" stroke="#00ffff" stroke-width="4"/>
                <line x1="40" y1="45" x2="53" y2="68" stroke="#00ffff" stroke-width="4"/>
            </svg>`,
            powerstance: `<svg viewBox="0 0 60 75">
                <circle cx="30" cy="10" r="8" fill="#00ffff"/>
                <line x1="30" y1="18" x2="30" y2="45" stroke="#00ffff" stroke-width="4"/>
                <line x1="30" y1="28" x2="15" y2="35" stroke="#00ffff" stroke-width="4"/>
                <line x1="15" y1="35" x2="18" y2="48" stroke="#00ffff" stroke-width="4"/>
                <line x1="30" y1="28" x2="45" y2="35" stroke="#00ffff" stroke-width="4"/>
                <line x1="45" y1="35" x2="42" y2="48" stroke="#00ffff" stroke-width="4"/>
                <line x1="30" y1="45" x2="18" y2="72" stroke="#00ffff" stroke-width="4"/>
                <line x1="30" y1="45" x2="42" y2="72" stroke="#00ffff" stroke-width="4"/>
            </svg>`,
            chillin: `<svg viewBox="0 0 50 75">
                <circle cx="25" cy="10" r="8" fill="#00ffff"/>
                <line x1="25" y1="18" x2="25" y2="48" stroke="#00ffff" stroke-width="4"/>
                <line x1="25" y1="28" x2="12" y2="50" stroke="#00ffff" stroke-width="4"/>
                <line x1="25" y1="28" x2="38" y2="50" stroke="#00ffff" stroke-width="4"/>
                <line x1="25" y1="48" x2="15" y2="72" stroke="#00ffff" stroke-width="4"/>
                <line x1="25" y1="48" x2="35" y2="72" stroke="#00ffff" stroke-width="4"/>
            </svg>`
        };

        // ============ POSES ============
        const POSES = {
            stickemup: {
                name: "STICK 'EM UP",
                hint: 'hands up like you mean it',
                svg: POSE_SVGS.stickemup,
                check: (lm) => {
                    const leftWrist = lm[15], rightWrist = lm[16];
                    const leftShoulder = lm[11], rightShoulder = lm[12];
                    return leftWrist.y < leftShoulder.y - 0.1 && rightWrist.y < rightShoulder.y - 0.1;
                }
            },
            tpose: {
                name: 'ASSERT DOMINANCE',
                hint: 'full T-pose, arms wide',
                svg: POSE_SVGS.tpose,
                check: (lm) => {
                    const leftWrist = lm[15], rightWrist = lm[16];
                    const leftShoulder = lm[11], rightShoulder = lm[12];
                    const armsWide = Math.abs(leftWrist.x - rightWrist.x) > 0.5;
                    const leftLevel = Math.abs(leftWrist.y - leftShoulder.y) < 0.15;
                    const rightLevel = Math.abs(rightWrist.y - rightShoulder.y) < 0.15;
                    return armsWide && leftLevel && rightLevel;
                }
            },
            flex: {
                name: 'GUN SHOW',
                hint: 'flex both arms, make it weird',
                svg: POSE_SVGS.flex,
                check: (lm) => {
                    const leftWrist = lm[15], rightWrist = lm[16];
                    const leftElbow = lm[13], rightElbow = lm[14];
                    const leftShoulder = lm[11], rightShoulder = lm[12];
                    const leftBent = leftElbow.y < leftShoulder.y && leftWrist.y < leftElbow.y;
                    const rightBent = rightElbow.y < rightShoulder.y && rightWrist.y < rightElbow.y;
                    const elbowsOut = Math.abs(leftElbow.x - rightElbow.x) > 0.25;
                    return leftBent && rightBent && elbowsOut;
                }
            },
            dab: {
                name: 'DAB ON EM',
                hint: 'one arm out, face in elbow',
                svg: POSE_SVGS.dab,
                check: (lm) => {
                    const leftWrist = lm[15], rightWrist = lm[16];
                    const leftElbow = lm[13], rightElbow = lm[14];
                    const nose = lm[0];
                    const leftUp = leftWrist.y < leftElbow.y - 0.1;
                    const rightUp = rightWrist.y < rightElbow.y - 0.1;
                    const leftAcross = Math.abs(leftWrist.x - nose.x) < 0.15;
                    const rightAcross = Math.abs(rightWrist.x - nose.x) < 0.15;
                    return (leftUp && rightAcross) || (rightUp && leftAcross);
                }
            },
            shrug: {
                name: 'NOT MY PROBLEM',
                hint: 'shrug, hands out, palms up energy',
                svg: POSE_SVGS.shrug,
                check: (lm) => {
                    const leftWrist = lm[15], rightWrist = lm[16];
                    const leftShoulder = lm[11], rightShoulder = lm[12];
                    const leftElbow = lm[13], rightElbow = lm[14];
                    const handsOut = Math.abs(leftWrist.x - rightWrist.x) > 0.3;
                    const leftMid = leftWrist.y > leftShoulder.y && leftWrist.y < leftShoulder.y + 0.25;
                    const rightMid = rightWrist.y > rightShoulder.y && rightWrist.y < rightShoulder.y + 0.25;
                    const elbowsBent = leftElbow.y > leftShoulder.y && rightElbow.y > rightShoulder.y;
                    return handsOut && leftMid && rightMid && elbowsBent;
                }
            },
            powerstance: {
                name: 'POWER STANCE',
                hint: 'hands on hips, own it',
                svg: POSE_SVGS.powerstance,
                check: (lm) => {
                    const leftWrist = lm[15], rightWrist = lm[16];
                    const leftHip = lm[23], rightHip = lm[24];
                    const leftNearHip = Math.abs(leftWrist.y - leftHip.y) < 0.12 && Math.abs(leftWrist.x - leftHip.x) < 0.15;
                    const rightNearHip = Math.abs(rightWrist.y - rightHip.y) < 0.12 && Math.abs(rightWrist.x - rightHip.x) < 0.15;
                    return leftNearHip && rightNearHip;
                }
            },
            chillin: {
                name: 'PLAY IT COOL',
                hint: 'arms down, chill vibes only',
                svg: POSE_SVGS.chillin,
                check: (lm) => {
                    const leftWrist = lm[15], rightWrist = lm[16];
                    const leftHip = lm[23], rightHip = lm[24];
                    return leftWrist.y > leftHip.y && rightWrist.y > rightHip.y;
                }
            }
        };
        const POSE_KEYS = Object.keys(POSES);

        // Build pose guide on title screen
        function buildPoseGuide() {
            const guide = document.getElementById('pose-guide');
            guide.innerHTML = POSE_KEYS.map(key => {
                const pose = POSES[key];
                return `<div class="pose-card">
                    <div class="pose-icon">${pose.svg}</div>
                    <div class="pose-name">${pose.name}</div>
                </div>`;
            }).join('');
        }
        buildPoseGuide();

        // ============ COMMENTARY LIBRARY ============
        const COMMENTARY = {
            success: [
                "acceptable.",
                "the bar was low. you cleared it.",
                "technically correct. the best kind of correct.",
                "that'll do.",
                "surprisingly competent.",
                "your ancestors can rest now.",
                "not terrible. high praise.",
                "the judges nod approvingly.",
                "someone somewhere is mildly impressed.",
                "you've done the bare minimum. congratulations.",
                "adequate. just adequate.",
                "well shit, it actually worked."
            ],
            fail: [
                "rough.",
                "that was... a choice.",
                "bold strategy. didn't pan out.",
                "your body said no.",
                "the audacity.",
                "we'll pretend that didn't happen.",
                "interesting interpretation.",
                "the judges are concerned.",
                "your confidence was inspiring. misplaced, but inspiring.",
                "were you even trying?",
                "that's one way to do it. the wrong way.",
                "your limbs have betrayed you.",
                "task failed successfully. wait, no. just failed."
            ],
            perfect: [
                "showoff.",
                "ok we get it.",
                "save some talent for the rest of us.",
                "annoyingly good.",
                "way to make everyone else look bad.",
                "performance of the century. allegedly.",
                "main character energy. gross.",
                "congrats on being that person."
            ],
            pathetic: [
                "genuinely impressive how bad that was.",
                "that's going in the group chat.",
                "your ancestors felt that one.",
                "historic failure. they'll write songs.",
                "legendary. for all the wrong reasons.",
                "you've peaked. this is it.",
                "somewhere, a PE teacher is crying.",
                "did you have a stroke or was that intentional?",
                "actual footage of a disaster.",
                "the camera saw that. we all saw that."
            ],
            twist_bait: [
                "oh you thought it was that easy?",
                "plot twist, bitch.",
                "surprise motherfucker.",
                "keep up.",
                "sike.",
                "gotcha."
            ],
            twist_copycat: [
                "hope you were paying attention.",
                "memory test. you're failing.",
                "what was it again? tick tock.",
                "remember? no? tragic."
            ],
            twist_opposite: [
                "brain vs body. fight.",
                "do the opposite. if you can.",
                "reverse psychology. you're welcome.",
                "your brain is screaming."
            ],
            twist_speed: [
                "no time to think. just vibes.",
                "speed round. survive.",
                "fast hands only. yours aren't.",
                "go go go go go"
            ],
            twist_freeze: [
                "DON'T. MOVE.",
                "statue mode activated.",
                "freeze or fail. simple.",
                "one twitch and you're done."
            ],
            nomination: [
                "choose your victim.",
                "who suffers next?",
                "point the finger.",
                "pick wisely. or don't.",
                "someone's about to have a bad time.",
                "time to ruin a friendship.",
                "pick someone you hate."
            ],
            wheel_shame: [
                "the wheel has spoken.",
                "fate has decided.",
                "the universe chose violence.",
                "you lost nomination privileges. pathetic."
            ]
        };

        const VERDICTS = {
            5: { text: 'IMMUNE', drinks: 0, drinkText: 'nominate someone to drink', canNominate: true },
            4: { text: 'SAFE', drinks: 0, drinkText: '', canNominate: false },
            3: { text: 'SAFE', drinks: 0, drinkText: '', canNominate: false },
            2: { text: 'ROUGH', drinks: 1, drinkText: 'take 1 drink', canNominate: false },
            1: { text: 'YIKES', drinks: 2, drinkText: 'take 2 drinks', canNominate: false },
            0: { text: 'PATHETIC', drinks: 3, drinkText: 'take 3 drinks', canNominate: false, wheelShame: true }
        };

        const END_ROASTS = {
            good: [
                "somebody actually tried. suspicious.",
                "decent showing. the bar remains underground.",
                "you survived. barely counts as winning but here we are."
            ],
            mid: [
                "aggressively average. as expected.",
                "mediocre. just like your dating life.",
                "nobody embarrassed themselves too badly. disappointing honestly."
            ],
            bad: [
                "that was painful to watch. and we watched the whole thing.",
                "collective failure. truly a team effort in sucking.",
                "the poses won. humanity lost. again."
            ]
        };

        // ============ STATE ============
        const state = {
            players: [],
            playedPlayers: [],
            currentPlayer: null,
            currentRound: 0,
            roundScore: 0,
            phase: 'title',
            landmarks: null,
            holdStart: 0,
            currentPose: null,
            currentTwist: null,
            lastPose: null,
            timerInterval: null,
            playerDrinks: {}
        };

        const config = {
            roundsPerPlayer: 5,
            holdTime: 500,
            baseReactionTime: 3500,
            minReactionTime: 2000
        };

        // ============ DOM ELEMENTS ============
        const video = document.getElementById('webcam');
        const previewVideo = document.getElementById('preview-video');

        // ============ UTILITY ============
        function randomFrom(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            // Hide neon header on title screen (it has its own title)
            document.querySelector('.neon-header').style.display = screenId === 'title-screen' ? 'none' : 'block';
        }

        // ============ TITLE SCREEN ============
        document.getElementById('start-game-btn-title').addEventListener('click', () => {
            showScreen('setup-screen');
        });

        // ============ PLAYER SETUP ============
        const playerInput = document.getElementById('player-name-input');
        const addBtn = document.getElementById('add-player-btn');
        const startBtn = document.getElementById('start-game-btn');
        const playerList = document.getElementById('player-list');
        const countInfo = document.getElementById('player-count-info');

        function updatePlayerList() {
            playerList.innerHTML = state.players.map((name, i) =>
                `<span class="player-tag">${name}<span class="remove-btn" onclick="removePlayer(${i})"></span></span>`
            ).join('');

            const count = state.players.length;
            countInfo.textContent = count < 2 ? `${count}/2 victims required` : `${count} victims ready`;
            startBtn.disabled = count < 2;
        }

        function addPlayer() {
            const name = playerInput.value.trim().toUpperCase().slice(0, 10);
            if (name && state.players.length < 8 && !state.players.includes(name)) {
                state.players.push(name);
                state.playerDrinks[name] = 0;
                playerInput.value = '';
                updatePlayerList();
            }
            playerInput.focus();
        }

        window.removePlayer = function(index) {
            const name = state.players[index];
            delete state.playerDrinks[name];
            state.players.splice(index, 1);
            updatePlayerList();
        };

        addBtn.addEventListener('click', addPlayer);
        playerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addPlayer();
        });

        startBtn.addEventListener('click', () => {
            if (state.players.length >= 2) {
                state.playedPlayers = [];
                document.getElementById('webcam-area').classList.remove('hidden');
                showWheelScreen('WHO\'S FIRST?');
            }
        });

        // ============ WHEEL ============
        const WHEEL_COLORS = [
            '#ff00ff', '#00ffff', '#ffcc00', '#ff6666',
            '#66ff66', '#ff66ff', '#66ffff', '#ffff66'
        ];

        function showWheelScreen(title) {
            showScreen('wheel-screen');
            document.getElementById('wheel-title').textContent = title;
            document.getElementById('wheel-result').textContent = '';

            const availablePlayers = state.players.filter(p => !state.playedPlayers.includes(p));
            buildWheel(availablePlayers);

            setTimeout(() => spinWheel(availablePlayers), 800);
        }

        function buildWheel(players) {
            const canvas = document.getElementById('wheel-canvas');
            const ctx = canvas.getContext('2d');
            const wheelInner = document.getElementById('wheel-inner');

            wheelInner.style.transition = 'none';
            wheelInner.style.transform = 'rotate(0deg)';

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = canvas.width / 2 - 5;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const segmentAngle = (2 * Math.PI) / players.length;

            players.forEach((name, i) => {
                const startAngle = i * segmentAngle - Math.PI / 2;
                const endAngle = startAngle + segmentAngle;

                // Draw segment
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = WHEEL_COLORS[i % WHEEL_COLORS.length];
                ctx.fill();

                // Draw border
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw name
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + segmentAngle / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = '#000';
                ctx.font = 'bold 14px "Press Start 2P"';
                ctx.shadowColor = '#fff';
                ctx.shadowBlur = 3;
                ctx.fillText(name, radius - 15, 5);
                ctx.restore();
            });
        }

        function spinWheel(players) {
            const wheelInner = document.getElementById('wheel-inner');
            const segmentAngle = 360 / players.length;

            const winnerIndex = Math.floor(Math.random() * players.length);
            const winner = players[winnerIndex];

            // Calculate spin - pointer is at top
            const spins = 5 + Math.random() * 3;
            const targetAngle = 360 * spins - (segmentAngle * winnerIndex + segmentAngle / 2);

            wheelInner.style.transition = 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
            wheelInner.style.transform = `rotate(${targetAngle}deg)`;

            setTimeout(() => {
                document.getElementById('wheel-result').textContent = `${winner}, YOU'RE UP`;

                setTimeout(() => {
                    state.currentPlayer = winner;
                    startHotSeat();
                }, 1500);
            }, 4200);
        }

        // ============ HOT SEAT GAME ============
        function startHotSeat() {
            state.currentRound = 0;
            state.roundScore = 0;
            state.lastPose = null;

            showScreen('game-screen');
            document.getElementById('current-player-label').textContent = state.currentPlayer;
            document.getElementById('score-val').textContent = '0/5';

            startRound();
        }

        function getTwistForRound(round) {
            if (round <= 2) return null;

            const chances = { 3: 0.4, 4: 0.6, 5: 0.8 };
            if (Math.random() > chances[round]) return null;

            const easyTwists = ['copycat', 'speed'];
            const hardTwists = ['bait', 'opposite', 'freeze'];

            if (round === 3) return randomFrom(easyTwists);
            if (round === 4) return randomFrom([...easyTwists, ...hardTwists]);
            return randomFrom(hardTwists);
        }

        function startRound() {
            state.currentRound++;

            if (state.currentRound > config.roundsPerPlayer) {
                showResults();
                return;
            }

            document.getElementById('round-num').textContent = state.currentRound;
            document.getElementById('pose-prompt').classList.remove('show', 'bait');
            document.getElementById('twist-badge').classList.remove('show');
            document.getElementById('match-status').classList.remove('show', 'holding', 'matched');
            document.getElementById('commentary').classList.remove('show');

            state.currentTwist = getTwistForRound(state.currentRound);

            if (state.currentTwist) {
                const badge = document.getElementById('twist-badge');
                const twistNames = {
                    bait: 'BAIT & SWITCH',
                    copycat: 'COPYCAT',
                    opposite: 'OPPOSITE DAY',
                    speed: 'SPEED ROUND',
                    freeze: 'FREEZE FRAME'
                };
                badge.textContent = twistNames[state.currentTwist];
                badge.classList.add('show');
            }

            state.phase = 'countdown';
            showCountdown();
        }

        function showCountdown() {
            const countEl = document.getElementById('countdown');
            let count = 3;

            countEl.textContent = count;
            countEl.classList.add('show');

            const interval = setInterval(() => {
                count--;
                if (count > 0) {
                    countEl.textContent = count;
                    countEl.classList.remove('show');
                    void countEl.offsetWidth;
                    countEl.classList.add('show');
                } else {
                    clearInterval(interval);
                    countEl.classList.remove('show');

                    if (state.currentTwist === 'speed') {
                        startSpeedRound();
                    } else if (state.currentTwist === 'freeze') {
                        startFreezeRound();
                    } else {
                        showPose();
                    }
                }
            }, 700);
        }

        function showPose() {
            state.phase = 'pose';

            let poseKey;

            if (state.currentTwist === 'copycat' && state.lastPose) {
                poseKey = state.lastPose;
                document.getElementById('pose-silhouette').innerHTML = POSES[poseKey].svg;
                document.getElementById('pose-text').textContent = 'COPYCAT!';
                document.getElementById('pose-hint').textContent = 'do the last pose again';
                showCommentary('twist_copycat');
            } else {
                do {
                    poseKey = POSE_KEYS[Math.floor(Math.random() * POSE_KEYS.length)];
                } while (poseKey === state.lastPose && POSE_KEYS.length > 1);

                const pose = POSES[poseKey];
                document.getElementById('pose-silhouette').innerHTML = pose.svg;
                document.getElementById('pose-text').textContent = pose.name;
                document.getElementById('pose-hint').textContent = pose.hint;
            }

            state.currentPose = { key: poseKey, ...POSES[poseKey] };
            state.lastPose = poseKey;

            if (state.currentTwist === 'opposite') {
                document.getElementById('pose-hint').textContent = 'DO ANY OTHER POSE!';
                showCommentary('twist_opposite');
            }

            document.getElementById('pose-prompt').classList.add('show');

            const reactionTime = Math.max(
                config.minReactionTime,
                config.baseReactionTime - (state.currentRound * 200)
            );

            const timerBar = document.getElementById('timer-bar');
            timerBar.style.transition = 'none';
            timerBar.style.transform = 'scaleX(1)';
            void timerBar.offsetWidth;
            timerBar.style.transition = `transform ${reactionTime}ms linear`;
            timerBar.style.transform = 'scaleX(0)';

            if (state.currentTwist === 'bait') {
                setTimeout(() => {
                    if (state.phase === 'pose' || state.phase === 'holding') {
                        let newKey;
                        do {
                            newKey = POSE_KEYS[Math.floor(Math.random() * POSE_KEYS.length)];
                        } while (newKey === poseKey);

                        state.currentPose = { key: newKey, ...POSES[newKey] };
                        state.lastPose = newKey;

                        document.getElementById('pose-prompt').classList.add('bait');
                        document.getElementById('pose-silhouette').innerHTML = POSES[newKey].svg;
                        document.getElementById('pose-text').textContent = 'WAIT - ' + POSES[newKey].name;
                        document.getElementById('pose-hint').textContent = POSES[newKey].hint;

                        showCommentary('twist_bait');

                        state.phase = 'pose';
                        state.holdStart = 0;
                    }
                }, reactionTime * 0.4);
            }

            state.timerInterval = setTimeout(() => {
                if (state.phase === 'pose' || state.phase === 'holding') {
                    judgeRound(false);
                }
            }, reactionTime);
        }

        function startSpeedRound() {
            showCommentary('twist_speed');
            let speedCount = 0;
            let speedSuccess = 0;

            function nextSpeedPose() {
                speedCount++;
                if (speedCount > 3) {
                    const success = speedSuccess >= 2;
                    judgeRound(success);
                    return;
                }

                state.phase = 'speed_pose';

                const poseKey = POSE_KEYS[Math.floor(Math.random() * POSE_KEYS.length)];
                state.currentPose = { key: poseKey, ...POSES[poseKey] };

                document.getElementById('pose-silhouette').innerHTML = POSES[poseKey].svg;
                document.getElementById('pose-text').textContent = POSES[poseKey].name;
                document.getElementById('pose-hint').textContent = `${speedCount}/3`;
                document.getElementById('pose-prompt').classList.add('show');

                const timerBar = document.getElementById('timer-bar');
                timerBar.style.transition = 'none';
                timerBar.style.transform = 'scaleX(1)';
                void timerBar.offsetWidth;
                timerBar.style.transition = 'transform 1.2s linear';
                timerBar.style.transform = 'scaleX(0)';

                state.speedTimeout = setTimeout(() => {
                    if (state.phase === 'speed_pose' || state.phase === 'speed_holding') {
                        document.getElementById('pose-prompt').classList.remove('show');
                        setTimeout(nextSpeedPose, 300);
                    }
                }, 1200);
            }

            state.speedSuccess = () => {
                speedSuccess++;
                clearTimeout(state.speedTimeout);
                document.getElementById('pose-prompt').classList.remove('show');
                document.getElementById('match-status').classList.remove('show');
                setTimeout(nextSpeedPose, 300);
            };

            nextSpeedPose();
        }

        function startFreezeRound() {
            showCommentary('twist_freeze');
            state.phase = 'freeze_wait';

            document.getElementById('pose-silhouette').innerHTML = '';
            document.getElementById('pose-text').textContent = 'MOVE AROUND...';
            document.getElementById('pose-hint').textContent = 'freeze when told';
            document.getElementById('pose-prompt').classList.add('show');

            const freezeDelay = 1500 + Math.random() * 2000;

            setTimeout(() => {
                state.phase = 'freeze_check';
                state.freezeStartLandmarks = state.landmarks ? [...state.landmarks] : null;

                document.getElementById('pose-text').textContent = 'FREEZE!';
                document.getElementById('pose-hint').textContent = "DON'T MOVE";
                document.getElementById('pose-prompt').classList.add('bait');

                setTimeout(() => {
                    const moved = checkIfMoved();
                    judgeRound(!moved);
                }, 1500);
            }, freezeDelay);
        }

        function checkIfMoved() {
            if (!state.freezeStartLandmarks || !state.landmarks) return false;

            const startLeft = state.freezeStartLandmarks[15];
            const startRight = state.freezeStartLandmarks[16];
            const nowLeft = state.landmarks[15];
            const nowRight = state.landmarks[16];

            const leftMove = Math.hypot(nowLeft.x - startLeft.x, nowLeft.y - startLeft.y);
            const rightMove = Math.hypot(nowRight.x - startRight.x, nowRight.y - startRight.y);

            return leftMove > 0.08 || rightMove > 0.08;
        }

        function checkPose() {
            if (!state.landmarks) return;

            if (state.phase === 'speed_pose' || state.phase === 'speed_holding') {
                const isMatch = state.currentPose.check(state.landmarks);
                const matchStatus = document.getElementById('match-status');

                if (isMatch) {
                    if (state.phase === 'speed_pose') {
                        state.phase = 'speed_holding';
                        state.holdStart = Date.now();
                        matchStatus.textContent = 'HOLD...';
                        matchStatus.classList.add('show', 'holding');
                    } else {
                        const holdDuration = Date.now() - state.holdStart;
                        if (holdDuration >= 300) {
                            matchStatus.textContent = 'GOT IT!';
                            matchStatus.classList.add('matched');
                            state.speedSuccess();
                        }
                    }
                } else if (state.phase === 'speed_holding') {
                    state.phase = 'speed_pose';
                    matchStatus.classList.remove('holding', 'matched');
                }
                return;
            }

            if (state.phase !== 'pose' && state.phase !== 'holding') return;

            let isMatch;

            if (state.currentTwist === 'opposite') {
                isMatch = false;
                for (const [key, pose] of Object.entries(POSES)) {
                    if (key !== state.currentPose.key && pose.check(state.landmarks)) {
                        isMatch = true;
                        break;
                    }
                }
            } else {
                isMatch = state.currentPose.check(state.landmarks);
            }

            const matchStatus = document.getElementById('match-status');

            if (isMatch) {
                if (state.phase === 'pose') {
                    state.phase = 'holding';
                    state.holdStart = Date.now();
                    matchStatus.textContent = 'HOLD IT...';
                    matchStatus.classList.add('show', 'holding');
                    matchStatus.classList.remove('matched');
                } else if (state.phase === 'holding') {
                    const holdDuration = Date.now() - state.holdStart;
                    if (holdDuration >= config.holdTime) {
                        matchStatus.textContent = 'MATCHED!';
                        matchStatus.classList.add('matched');
                        matchStatus.classList.remove('holding');
                        judgeRound(true);
                    } else {
                        matchStatus.textContent = `HOLD ${Math.ceil((config.holdTime - holdDuration) / 100)}...`;
                    }
                }
            } else if (state.phase === 'holding') {
                state.phase = 'pose';
                matchStatus.classList.remove('holding', 'matched');
                matchStatus.textContent = 'ALMOST...';
            }
        }

        function judgeRound(success) {
            clearTimeout(state.timerInterval);
            state.phase = 'result';

            document.getElementById('pose-prompt').classList.remove('show', 'bait');
            document.getElementById('match-status').classList.remove('show', 'holding', 'matched');

            const resultEl = document.getElementById('result-overlay');
            const resultText = document.getElementById('result-text');
            const resultSub = document.getElementById('result-sub');

            if (success) {
                state.roundScore++;
                resultText.textContent = 'NICE';
                resultText.className = 'result-text success';
                resultSub.textContent = `${state.roundScore}/${config.roundsPerPlayer}`;
                showCommentary('success');
            } else {
                resultText.textContent = 'NOPE';
                resultText.className = 'result-text fail';
                resultSub.textContent = state.currentPose ? state.currentPose.name : '';
                showCommentary('fail');
            }

            document.getElementById('score-val').textContent = `${state.roundScore}/${config.roundsPerPlayer}`;

            resultEl.classList.add('show');

            setTimeout(() => {
                resultEl.classList.remove('show');
                startRound();
            }, 1800);
        }

        function showCommentary(type) {
            const el = document.getElementById('commentary');
            el.textContent = randomFrom(COMMENTARY[type] || COMMENTARY.success);
            el.classList.remove('show');
            void el.offsetWidth;
            el.classList.add('show');
        }

        // ============ RESULTS ============
        function showResults() {
            showScreen('results-screen');

            const score = state.roundScore;
            const verdict = VERDICTS[score];

            document.getElementById('results-player').textContent = state.currentPlayer;
            document.getElementById('results-score').textContent = `${score}/5`;
            document.getElementById('results-verdict').textContent = verdict.text;

            if (verdict.drinks > 0) {
                state.playerDrinks[state.currentPlayer] += verdict.drinks;
                document.getElementById('results-drinks').textContent = ` ${verdict.drinkText.toUpperCase()}`;
            } else if (verdict.canNominate) {
                document.getElementById('results-drinks').textContent = ' NOMINATE SOMEONE TO DRINK';
            } else {
                document.getElementById('results-drinks').textContent = '';
            }

            const commentType = score === 5 ? 'perfect' : score <= 1 ? 'pathetic' : 'success';
            document.getElementById('results-commentary').textContent = randomFrom(COMMENTARY[commentType]);

            state.playedPlayers.push(state.currentPlayer);

            const nominateSection = document.getElementById('nominate-section');
            const nominateTitle = document.getElementById('nominate-title');
            const nominateButtons = document.getElementById('nominate-buttons');

            const remainingPlayers = state.players.filter(p => !state.playedPlayers.includes(p));

            if (remainingPlayers.length === 0) {
                nominateSection.style.display = 'none';
                setTimeout(showEndScreen, 2000);
            } else if (verdict.wheelShame) {
                nominateTitle.textContent = randomFrom(COMMENTARY.wheel_shame);
                nominateButtons.innerHTML = '<button class="nominate-btn" onclick="triggerWheelOfShame()">SPIN THE WHEEL</button>';
            } else if (verdict.canNominate) {
                nominateTitle.textContent = randomFrom(COMMENTARY.nomination) + ' (THEY DRINK + GO NEXT)';
                nominateButtons.innerHTML = remainingPlayers.map(p =>
                    `<button class="nominate-btn" onclick="nominatePlayer('${p}', true)">${p}</button>`
                ).join('');
            } else {
                nominateTitle.textContent = 'WHO\'S NEXT?';
                nominateButtons.innerHTML = remainingPlayers.map(p =>
                    `<button class="nominate-btn" onclick="nominatePlayer('${p}', false)">${p}</button>`
                ).join('');
            }
        }

        window.nominatePlayer = function(name, withDrink) {
            if (withDrink) {
                state.playerDrinks[name] = (state.playerDrinks[name] || 0) + 1;
            }
            state.currentPlayer = name;
            startHotSeat();
        };

        window.triggerWheelOfShame = function() {
            showWheelScreen('WHEEL OF SHAME');
        };

        // ============ END SCREEN ============
        function showEndScreen() {
            showScreen('end-screen');

            const sorted = Object.entries(state.playerDrinks)
                .sort((a, b) => b[1] - a[1]);

            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = sorted.map(([name, drinks], i) => `
                <div class="leaderboard-row">
                    <span class="rank">${i + 1}.</span>
                    <span class="name">${name}</span>
                    <span class="drinks">${drinks} </span>
                </div>
            `).join('');

            const totalDrinks = Object.values(state.playerDrinks).reduce((a, b) => a + b, 0);
            const avgDrinks = totalDrinks / state.players.length;
            const roastType = avgDrinks < 1 ? 'good' : avgDrinks < 2 ? 'mid' : 'bad';
            document.getElementById('end-roast').textContent = randomFrom(END_ROASTS[roastType]);
        }

        document.getElementById('play-again-btn').addEventListener('click', () => {
            state.players = [];
            state.playedPlayers = [];
            state.playerDrinks = {};
            document.getElementById('webcam-area').classList.add('hidden');
            updatePlayerList();
            showScreen('title-screen');
        });

        // ============ POSE DETECTION ============
        const pose = new Pose({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
        });

        pose.setOptions({
            modelComplexity: 1,
            smoothLandmarks: true,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        pose.onResults((results) => {
            if (results.poseLandmarks) {
                state.landmarks = results.poseLandmarks;
                checkPose();
            }
        });

        // ============ SETUP ============
        async function setup() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { width: 1280, height: 720, facingMode: 'user' }
                });
                video.srcObject = stream;
                previewVideo.srcObject = stream;
                await new Promise(r => { video.onloadedmetadata = () => { video.play(); r(); }; });
                previewVideo.play();

                const cam = new Camera(video, {
                    onFrame: async () => {
                        await pose.send({ image: video });
                    },
                    width: 1280,
                    height: 720
                });
                await cam.start();

                document.getElementById('loading').classList.add('hidden');
            } catch (e) {
                document.getElementById('loading').innerHTML =
                    `CAMERA ERROR<br><span style="font-size:10px;color:#888;">${e.message}</span>`;
            }
        }

        setup();
    </script>
</body>
</html>
